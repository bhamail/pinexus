<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2024-04-21 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20240421" />
    <meta http-equiv="Content-Language" content="en" />
    <title>PiNexus &#x2013; Nexus Setup</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>PiNexus</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2024-04-21<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
            <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Introduction"><span class="icon-chevron-down"></span>Introduction</a>
      <ul class="nav nav-list">
    <li><a href="supplies.html" title="Supplies"><span class="none"></span>Supplies</a>  </li>
    <li><a href="setup.html" title="Setup"><span class="icon-chevron-down"></span>Setup</a>
      <ul class="nav nav-list">
    <li><a href="sdcardsetup.html" title="SD Card Setup"><span class="none"></span>SD Card Setup</a>  </li>
    <li><a href="ossetup.html" title="OS Setup"><span class="none"></span>OS Setup</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Nexus Setup</a>
  </li>
    <li><a href="repotest.html" title="Repo Test"><span class="none"></span>Repo Test</a>  </li>
      </ul>
  </li>
    <li><a href="docdocs.html" title="Doc docs"><span class="none"></span>Doc docs</a>  </li>
      </ul>
  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Nexus Setup</h1>
<p>Thanks to the <a class="externalLink" href="https://github.com/sonatype-nexus-community/nexus-repository-installer">nexus-repository-installer</a> project on the <a class="externalLink" href="https://github.com/sonatype-nexus-community">Sonatype Community</a>, the steps to install (and update) Nexus Repository Manager are now greatly simplified.</p>
<p>The old manual steps are archived here for reference: <a href="obsolete/nexussetup.html">Old Nexus Setup</a>, <a href="obsolete/nexusdaemonsetup.html">Old Nexus Daemon</a></p>
<ol style="list-style-type: decimal">

<li>

<p>Use the latest Java 8 release version of Java available from OpenJDK.</p>
<p>Java runtimes above Java 8 <a class="externalLink" href="https://help.sonatype.com/repomanager3/system-requirements#SystemRequirements-Java">have not been verified</a> - do not use them:</p>

<div>
<div>
<pre class="source">pi@raspberrypi:~ $ java -version
java version &quot;1.8.0&quot;
Java(TM) SE Runtime Environment (build 1.8.0-b132)
Java HotSpot(TM) Client VM (build 25.0-b70, mixed mode)
</pre></div></div>

<p>Notes from the bleeding edge: The 32bit JVM on Pi OS can&#x2019;t access more than 4gb of memory. In order to try accessing more memory, I installed a 64bit version of Pi OS (danger, unstable, run away). Unfortunately, Nexus Repository Manager still requires jdk8 - which is not available by default from the debian buster repos. Below are the hoops I jumped through to get a recognized java 8 installation.</p>
<ul>

<li>create file: <tt>/etc/apt/sources.list.d/adoptopenjdk.list</tt> with content: <tt>deb https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/ buster main</tt></li>
<li>run the following:</li>
</ul>

<div>
<div>
<pre class="source">$ sudo apt update
$ wget -qO - https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public | sudo apt-key add -
$ sudo apt install adoptopenjdk-8-hotspot
</pre></div></div>

<ul>

<li>run the documented installer steps, and all should be well.</li>
</ul>
</li>
<li>

<p>Follow these <a class="externalLink" href="https://github.com/sonatype-nexus-community/nexus-repository-installer#apt-setup">Apt Setup</a> steps to add the installer package repository. You can run the last step to install Nexus Repository Manager, but then you should immediately stop the Nexus daemon to allow you to customize the memory settings for the Pi. For example:</p>

<div>
<div>
<pre class="source"># AFTER following the steps from &quot;Apt Setup&quot; above, do the following:
# Stop the service before changing configuration
sudo service nexus-repository-manager stop
</pre></div></div>
</li>
<li>

<p>If you run Nexus with the default memory settings, you could run into problems.</p>
<p>A Pi currently only has 1 GB to 8 GB of RAM. If your Pi has less than 8 GB of RAM, you should configure Nexus to use less RAM than normal, and allocate less direct memory for use by the <a class="externalLink" href="https://support.sonatype.com/hc/en-us/articles/115007093447-Optimizing-OrientDB-Database-Memory-">database</a>. Edit the <tt>nexusvm.options</tt> file:</p>

<div>
<div>
<pre class="source">sudo vi /opt/sonatype/nexus3/bin/nexus.vmoptions
</pre></div></div>

<p>Change:</p>

<div>
<div>
<pre class="source">-Xms2703m
-Xmx2703m
-XX:MaxDirectMemorySize=2703m
</pre></div></div>

<p>to:</p>

<div>
<div>
<pre class="source">-Xms1200M
-Xmx1200M
-XX:MaxDirectMemorySize=2G
</pre></div></div>

<p>or for a Pi with less than 4 GB of RAM, use:</p>

<div>
<div>
<pre class="source">-Xms350M
-Xmx350M
-XX:MaxDirectMemorySize=350M
</pre></div></div>

<p>Additional steps for Nexus versions 3.19 and newer:</p>
<p>Also change:</p>

<div>
<div>
<pre class="source"> -Djava.endorsed.dirs=lib/endorsed
</pre></div></div>

<p>to:</p>

<div>
<div>
<pre class="source"> -Djava.endorsed.dirs=lib/endorsed:/opt/sonatype/jna
</pre></div></div>

<p><i>NOTE</i>: Newer versions of Nexus (3.19+) ship with a version of OrientDB which includes a version of <a class="externalLink" href="https://github.com/java-native-access/jna">jna</a> that accidentally omitted the ARM versions of some native libs.</p>
<p>The solution is to manually download a newer version of jna, via:</p>

<div>
<div>
<pre class="source"> sudo mkdir /opt/sonatype/jna
 cd /opt/sonatype/jna
 sudo wget https://repo1.maven.org/maven2/net/java/dev/jna/jna/5.5.0/jna-5.5.0.jar
 sudo wget https://repo1.maven.org/maven2/net/java/dev/jna/jna-platform/5.5.0/jna-platform-5.5.0.jar
 sudo chmod +x /opt/sonatype/jna/*
</pre></div></div>
</li>
<li>

<p>Launch nexus.</p>
<p>To see the log output on the console, use this command:</p>

<div>
<div>
<pre class="source">sudo service nexus-repository-manager start
</pre></div></div>

<p>You can &#x2018;tail&#x2019; the nexus log file to watch startup progress using a command like this:</p>

<div>
<div>
<pre class="source">tail -n 500  -f /opt/sonatype/sonatype-work/nexus3/log/nexus.log
</pre></div></div>

<p>Watch for a message like:</p>

<div>
<div>
<pre class="source">-------------------------------------------------

Started Sonatype Nexus OSS 3.15.2-01

-------------------------------------------------
</pre></div></div>

<p>While Nexus is starting, you can monitor the system work load using <tt>top</tt>. Wait for the <tt>java</tt> process to ease up on the cpu (well below 100% CPU in <tt>top</tt>).  Then from your PC, open the link below to Nexus running on the Pi:</p>

<div>
<div>
<pre class="source">http://the-Pi-IP-address:8081
</pre></div></div>

<p>For security reasons, recent versions of Nexus generate a unique admin password during the first startup. To read the generated admin password for your first login to the web UI, you can use the command below:</p>

<div>
<div>
<pre class="source">cat /opt/sonatype/sonatype-work/nexus3/admin.password &amp;&amp; echo
</pre></div></div>

<p>For simplicity, you should check <tt>Enable anonymous access</tt> in the prompts following your first login.</p>
<p>Huzzah! Nexus is running on your Pi.</p>
</li>
</ol>
<p>Next step: <a href="repotest.html">Repository Test</a></p>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2015&#x2013;2024.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>