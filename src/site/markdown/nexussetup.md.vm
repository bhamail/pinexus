Nexus Setup
===========
 
 Thanks to the [nexus-repository-installer](https://github.com/sonatype-nexus-community/nexus-repository-installer)
  project on the [Sonatype Community](https://github.com/sonatype-nexus-community), the steps to install (and update)
  Nexus Repository Manager are now greatly simplified.

  The old manual steps are archived here for reference: [Old Nexus Setup](obsolete/nexussetup.html), [Old Nexus Daemon](obsolete/nexusdaemonsetup.html)

  1. Use the latest Java 8 release version of Java available from OpenJDK.

     Java runtimes above Java 8 [have not been verified](https://help.sonatype.com/repomanager3/system-requirements#SystemRequirements-Java) - do not use them:
    
        pi@raspberrypi:~ $ java -version
        java version "1.8.0"
        Java(TM) SE Runtime Environment (build 1.8.0-b132)
        Java HotSpot(TM) Client VM (build 25.0-b70, mixed mode)

  2. Follow these [Apt Setup](https://github.com/sonatype-nexus-community/nexus-repository-installer#apt-setup) steps
     to add the installer package repository. You can run the last step to install Nexus Repository Manager, but then
     you should immediately stop the Nexus daemon to allow you to customize the memory settings for the Pi. For example:

        # Setup APT Repository and install
        wget -qO - https://nx-staging.sonatype.com/repository/community-hosted/pki/deb-gpg/DEB-GPG-KEY-Sonatype.asc | sudo apt-key add -
        curl https://nx-staging.sonatype.com/repository/community-hosted/sonatype-community.list | sudo tee /etc/apt/sources.list.d/sonatype-community.list
        sudo apt-get update && sudo apt-get install nexus-repository-manager

        # Setup Yum Repository and install
        curl https://nx-staging.sonatype.com/repository/community-hosted/sonatype-community.repo | sudo tee /etc/yum.repos.d/sonatype-community.repo
        sudo yum install nexus-repository-manager
        
        # Stop the service before change the configurations
        sudo service nexus-repository-manager stop


  3. If you run Nexus with the default memory settings, you could run into problems.

     A Pi currently only has 1GB to 4GB of RAM. You should configure Nexus to use less
     RAM than normal, and allocate less direct memory for use by the
     [database](https://support.sonatype.com/hc/en-us/articles/115007093447-Optimizing-OrientDB-Database-Memory-).
     Edit the `nexusvm.options` file:
     
        sudo vi /opt/sonatype/nexus3/bin/nexus.vmoptions
        
     Change:
     
        -Xms2703m
        -Xmx2703m
        -XX:MaxDirectMemorySize=2703m

     to:
        
        -Xms1200M
        -Xmx1200M
        -XX:MaxDirectMemorySize=2G

     or for a Pi with less than 4GB of RAM, to:
     
        -Xms350M
        -Xmx350M
        -XX:MaxDirectMemorySize=350M

     Additional steps for Nexus versions 3.19 and newer:

     Also change:

         -Djava.endorsed.dirs=lib/endorsed

     to:

         -Djava.endorsed.dirs=lib/endorsed:/opt/sonatype/jna

     *NOTE*: Newer versions of Nexus (3.19+) ship with a version of OrientDB which includes a version of
     [jna](https://github.com/java-native-access/jna) that accidentally omitted the ARM versions of some native libs.

     The solution is to manually download a newer version of jna, via:

         sudo mkdir /opt/sonatype/jna
         cd /opt/sonatype/jna
         sudo wget https://repo1.maven.org/maven2/net/java/dev/jna/jna/5.5.0/jna-5.5.0.jar
         sudo wget https://repo1.maven.org/maven2/net/java/dev/jna/jna-platform/5.5.0/jna-platform-5.5.0.jar
         sudo chmod +x /opt/sonatype/jna/*

  4. Launch nexus.

    To see the log output on the console, use this command:

        sudo service nexus-repository-manager start

    You can 'tail' the nexus log file to watch startup progress using a command like this:

        tail -n 500  -f /opt/sonatype/sonatype-work/nexus3/log/nexus.log

    Watch for a message like:
    
        -------------------------------------------------
        
        Started Sonatype Nexus OSS ${version-number-latest-nexus-repo-release-number}
        
        -------------------------------------------------

    While Nexus is starting, you can monitor the system work load using `top`. Wait for the `java` process to ease up on 
    the cpu (well below 100% CPU in `top`).  Then from your PC, open the link below to Nexus running on the Pi:
  
        http://the-Pi-IP-address:8081

    For security reasons, recent versions of Nexus generate a unique admin password during the first startup.
    To read the generated admin password for your first login to the web UI, you can use the command below:

        cat /opt/sonatype/sonatype-work/nexus3/admin.password && echo

    For simplicity, you should check `Enable anonymous access` in the prompts following your first login.
   
     Huzzah! Nexus is running on your Pi.  
   
Next step: [Repository Test](repotest.html)
   